<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peta Futuristik Multi-Layer Responsif</title>

<!-- LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
<link href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css" rel="stylesheet" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<style>
body {
  margin: 0;
  padding: 0;
}

#map {
  height: 90vh;
  width: 100%;
  margin: 0;
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
  transition: all 0.5s ease;
}

/* === CONTAINER === */
.map-container {
  display: flex;
  flex-direction: row;
  width: 95%;
  margin: 30px auto;
  gap: 15px;
  min-height: 70vh;
}

.controls {
  position: static;
  z-index: 1000;
  background: rgba(20, 20, 30, 0.95);
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 0 15px rgba(0,255,255,0.6), 0 0 30px rgba(0,128,255,0.4);
  border: 1px solid rgba(0,255,255,0.6);
  backdrop-filter: blur(10px);
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 250px;
  min-width: 250px;
  font-family: 'Arial', sans-serif;
  font-weight: bold;
  font-size: 15px;
  color: #e9ffff;
  transition: all 0.5s ease;
}

.controls div {
  display: flex;
  flex-direction: column;
  width: 100%;
  gap: 5px;
}

   .controls h3 {
      margin: 0 0 10px 0;
      color: #00ffff;
      border-bottom: 1px solid rgba(0, 255, 255, 0.3);
      padding-bottom: 10px;
      font-size: 1.2em;
      letter-spacing: 1px;
      text-align: center;
    }

    .controls div.input-container {
      display: flex;
      flex-direction: column;
      width: 90%;
      gap: 5px;
      position: relative;
    }

    .controls label {
      font-size: 0.85em;
      font-weight: bold;
      color: #99ffff;
    }

    .controls input,
    .controls select {
      padding: 10px;
      border: none;
      border-radius: 6px;
      background: rgba(0,0,50,0.8);
      color: #fff;
      box-shadow: 0 0 5px rgba(0,255,255,0.3) inset;
      transition: all 0.3s;
      font-weight: 500;
    }

    .controls input:focus,
    .controls select:focus {
      background: rgba(0,0,70,0.9);
      box-shadow: 0 0 10px rgba(0,255,255,0.6) inset, 0 0 5px rgba(0, 255, 255, 0.4);
      outline: none;
    }


.location-icon {
  color: #00ffff;
  text-shadow: 0 0 8px #00ffff7c;
  font-size: 1.2em;
  margin-right: 5px;
}


/* --- CSS UNTUK SLIDER INTERAKTIF (RADIO BUTTON) START --- */

.input-container .vehicle-slider {
  display: flex !important;
  flex-direction: row !important;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

.input-container .vehicle-slider .vehicle-label {
  flex: 1;
 text-align: center;
}


.vehicle-slider {
  display: flex;                 /* sejajarkan ke samping */
  justify-content: space-between;/* beri jarak antar item */
  align-items: center;
  background: rgba(0, 0, 50, 0.8);
  border-radius: 10px;
  box-shadow: 0 0 8px rgba(0, 255, 255, 0.3) inset;
  padding: 1px;
  gap: 10px;                     /* jarak antar tombol */
}

.vehicle-slider input[type="radio"] {
  display: none; /* sembunyikan radio aslinya */
}

.vehicle-label {
  flex: 1;                       /* biar tiap tombol sama lebar */
  text-align: center;
  padding: 12px 0;
  cursor: pointer;
  border-radius: 6px;
  font-size: 1.3em;
  color: #99ffff;
  opacity: 0.6;
  transition: all 0.3s ease;
  background: rgba(0, 255, 255, 0.05);
  user-select: none;
}

/* Hover effect */
.vehicle-label:hover {
  opacity: 1;
  color: #00ffff;
  background: rgba(0, 255, 255, 0.15);
  transform: scale(1.03);
}

/* Aktif (dipilih) */
.vehicle-slider input[type="radio"]:checked + .vehicle-label {
  background: linear-gradient(135deg, #00ffff, #0088ff);
  color: #151520;
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.8),
              inset 0 0 8px rgba(0, 0, 0, 0.5);
  transform: scale(1.07);
  opacity: 1;
}

/* --- CSS UNTUK SLIDER INTERAKTIF (RADIO BUTTON) END --- */
/* Hapus CSS lama untuk select */
.controls select.animate-change {
    /* HAPUS ATAU KOMENTARI INI */
}
.controls select option {
    /* HAPUS ATAU KOMENTARI INI */
}

/* 3. Penyesuaian Tombol Route agar tidak menyentuh Vehicle select */
.controls button#routeBtn {
    margin-top: 10px; /* Tambahkan sedikit ruang di atas tombol Route */
}
/* Menghilangkan label placeholder yang tidak perlu (UX lebih bersih) */
.controls .input-container label:empty {
    display: none;
}
/* Memastikan input-container untuk Route button tidak memiliki label kosong */
.controls .input-container:has(#routeBtn) {
    justify-content: flex-end; /* Dorong tombol ke bawah */
}

/* --- BUTTON --- */
    .controls button#routeBtn {
      padding: 8px 20px;
      border-radius: 8px;
      background: linear-gradient(90deg, #00f6ff, #005fff);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
      transition: all 0.3s;
      text-transform: uppercase;
      margin-top: 0px;
    }

    .controls button#routeBtn:hover {
      background: linear-gradient(90deg, #00ffff, #0088ff);
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.8);
      transform: translateY(-1px);
    }



/* --- SWAP BUTTON STYLE BARU --- */
#swapBtn {
grid-column: 1 / -1; /* Ambil seluruh lebar di grid */
margin: -10px -20px -30px 225px; 

padding: 5px 10px; 
font-size: 1rem; 
border-radius: 50%; 
width: 30px; 
height: 30px; 
display: flex; 
align-items: center; 
justify-content: center; 
background: linear-gradient(45deg, rgba(0, 255, 255, 0.3), rgba(0, 100, 255, 0.3)); 
border: 1px solid #00ffff; 
box-shadow: 0 0 10px #00ffff88; 
color: #00ffff; 
cursor: pointer; 
transition: all 0.3s;
outline: none;
}
#swapBtn:hover {
box-shadow: 0 0 20px #00ffff;
transform: rotate(360deg) scale(1.1);
}
#swapBtn:active {
background: linear-gradient(45deg, #00ffff, #0088ff);
color: #151520;
}

.leaflet-fullscreen-on .map-container {
  flex-direction: column;
  width: 100%;
  height: 100vh;
  margin: 0;
  gap: 0;
}
.leaflet-fullscreen-on #map {
  width: 100%;
  height: 100vh;
  border-radius: 0;
  margin: 0;
}
.leaflet-fullscreen-on .controls {
  position: absolute;
  top: 45px;
  left: 50%;
  transform: translateX(-50%);
  flex-direction: row;
  width: auto;
  padding: 12px 20px;
  background: rgba(20, 20, 30, 0.75);
  z-index: 9000;
}
.leaflet-fullscreen-on .controls input,
.leaflet-fullscreen-on .controls select {
  width: 140px;
}
.leaflet-fullscreen-on .controls div {
  flex-direction: row;
  align-items: center;
  width: auto;
}
.leaflet-fullscreen-on .controls div label {
  margin-right: 5px;
}


.controls:hover {
  background: rgba(30, 30, 50, 0.85);
  box-shadow: 0 0 25px rgba(0,255,255,0.5);
}

.controls input, .controls select {
  padding: 8px;
  border: none;
  border-radius: 8px;
  background: rgba(0,0,50,0.6);
  color: #fff;
  box-shadow: 0 0 8px rgba(0,255,255,0.4) inset;
}
.controls button {
  padding: 6px 20px;
  border-radius: 8px;
  background: linear-gradient(45deg, #00f6ff, #005fff);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}
.controls button:hover {
  background: linear-gradient(45deg, #00ffff, #0088ff);
}

.futuristic-icon {
  border: 1.5px solid rgba(27, 27, 27, 0.7);
  border-radius: 50%;
}
.icon-recreation {
    background: linear-gradient(135deg, rgba(135, 206, 250, 0.892), rgba(0, 255, 255, 0.7)); 
    border: 1.5px solid rgba(27, 27, 27, 0.688); /* Border Hijau Pastel 2px */
    border-radius: 50%; /* Membuat border berbentuk lingkaran */
}
.icon-recreation:hover {
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.9), 0 0 20px rgba(0, 200, 200, 0.6); /* Glow Cyan/Elektrik */
    border-color: rgba(0, 255, 255, 1.0); 
    transform: scale(1.1);
}
.icon-recreation.marker-active, .icon-recreation.marker-active:hover { 
   box-shadow: 0 0 10px rgba(0, 255, 255, 0.9), 0 0 20px rgba(0, 200, 200, 0.6); /* Glow Cyan/Elektrik */
    border-color: rgba(0, 255, 255, 1.0); 
    border-width: 4px; 
    transform: scale(1.15); 

}

.suggestions {
  position: absolute;
  width: 250px;
  background: rgba(20, 20, 30, 1);
  border-radius: 0 0 8px 8px;
  box-shadow: 0 5px 15px rgba(0,255,255,0.5);
  z-index: 1001;
  max-height: 200px;
  overflow-y: auto;
  left: 0;
  top: 100%;
}
.suggestion-item {
  padding: 8px;
  cursor: pointer;
  font-size: 14px;
  color: #e9ffff;
  border-bottom: 1px solid rgba(0,255,255,0.2);
}
.suggestion-item:hover {
  background: rgba(0,255,255,0.1);
}



/* --- STYLE KONTROL LAPISAN (L.control.layers) --- */

.leaflet-control-layers {
    /* Background dan Border */
    background: rgba(20, 20, 30, 0.95) !important; /* Sama seperti sidebar, lebih gelap */
    border: 1px solid rgba(0, 255, 255, 0.6) !important; /* Border Neon */
    border-radius: 10px !important;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.5) !important;
    backdrop-filter: blur(5px);
    color: #e9ffff; /* Warna teks putih neon */
    font-size: 14px;
    font-weight: 500;
}

/* Header Layers (Saat diklik, muncul daftar lapisan) */
.leaflet-control-layers-expanded {
    padding: 10px;
    background: rgba(20, 20, 30, 0.95) !important; /* Pastikan background tetap gelap saat terbuka */
}

/* Style saat mouse di atas kontrol */
.leaflet-control-layers:hover {
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.8), 0 0 20px rgba(0, 128, 255, 0.5) !important;
}

/* Checkbox/Radio Button Style */
.leaflet-control-layers label {
    margin: 5px 0;
    cursor: pointer;
    border-bottom: 1px dashed rgba(0, 255, 255, 0.2);
    padding-bottom: 3px;
    transition: color 0.3s;
}

.leaflet-control-layers label:hover {
    color: #00ffff; /* Efek hover neon pada teks */
}

/* Hapus padding dan margin berlebihan dari list item */
.leaflet-control-layers-base label {
    display: block;
}
.leaflet-control-layers-separator {
    display: none; /* Sembunyikan garis pemisah default */
}



/* Mengubah warna teks opsi di dalam dropdown menjadi hitam/gelap */
/* Styling untuk opsi (item) dalam dropdown kendaraan */
.controls select option {
    /* Background: Tema gelap konsisten dengan kontrol futuristik */
    background-color: rgba(20, 20, 40, 0.98); /* Sangat gelap, hampir hitam */
    
    /* Text Color: Neon Light/White */
    color: #e9ffff; 
    
    /* Padding: Berikan sedikit ruang untuk keterbacaan */
    padding: 10px 15px;
    
    /* Font: Atur ulang agar terlihat bersih */
    font-size: 15px;
    font-weight: 500;
    
    /* Border: Hapus border karena tidak efektif untuk styling option */
    border: none; 
    
    /* Efek visual lainnya: Gunakan bayangan teks untuk sedikit glow */
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.5); 
}

/* Catatan: Pseudo-class :checked atau :hover pada option umumnya tidak didukung konsisten.
   Browser modern akan menangani efek hover secara native, tetapi Anda memastikan warna dasarnya futuristik. */

</style>
</head>

<body>
<div class="map-container">
    <div class="controls">
        <h3>ROUTE & EXPLORE üöÄ</h3>
        
        <div class="input-container">
            <button id="locateBtn">üìç My Location</button>
            <label for="startLocation">START LOCATION <span class="location-icon"></span> </label>
            <input type="text" id="startLocation" placeholder="Type Start Location">
            <div id="startSuggestions" class="suggestions"></div>
        </div>

        <button id="swapBtn" title="Tukar Lokasi">‚áÑ</button>

        <div class="input-container">
            <label for="endLocation">DESTINATION</label>
            <input type="text" id="endLocation" placeholder="Type Destination">
            <div id="endSuggestions" class="suggestions"></div>
        </div>
    
   <div class="input-container">
<label>VEHICLE</label>
 <div id="vehicle-select" class="vehicle-slider">
 <input type="radio" id="car" name="vehicle" value="car" checked>
 <label for="car" class="vehicle-label" title="Car">üöó</label>

 <input type="radio" id="motorbike" name="vehicle" value="motorcycle">
<label for="motorbike" class="vehicle-label" title="Motorcycle">üèçÔ∏è</label>

<input type="radio" id="foot" name="vehicle" value="foot">
 <label for="foot" class="vehicle-label" title="Foot">üö∂</label>
</div>
</div>
        
        <div class="input-container">
            <label>&nbsp;</label> <button id="routeBtn">FIND ROUTE</button>
        </div>
    </div> 
    <div id="map"></div> 
    </div>

<script>
// === 1. Inisialisasi Peta ===

const map = L.map('map').setView([-6.9034, 107.6186], 10);
const baseMaps = {
    "Satelit": L.tileLayer('https://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {subdomains:['mt0','mt1','mt2','mt3']}),
    "Peta": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
    "Road Map": L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', { 
        subdomains:['mt0','mt1','mt2','mt3']}),
    "Dark Matter": L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/attributions">Carto</a>',
        subdomains: 'abcd',
        maxZoom: 20
    }),
};

baseMaps["Peta"].addTo(map);
L.control.layers(baseMaps).addTo(map);
map.addControl(new L.Control.Fullscreen());

document.addEventListener('DOMContentLoaded', () => setTimeout(() => map.invalidateSize(), 100));
map.on('fullscreenchange', () => map.invalidateSize());

// === Lokasi Awal ===
// Koordinat Bandung
const cafeCoords = [-6.9030, 107.6186];
const startInput = document.getElementById('startLocation');

// 1. Tentukan DEFAULT LOKASI PETA dan INPUT (BANDUNG)
map.setView(cafeCoords, 13); // <-- Atur tampilan peta ke Bandung secara default
startInput.value = "Drunk Baker Cihapit (Titik Awal)";
startInput.dataset.lat = cafeCoords[0];
startInput.dataset.lon = cafeCoords[1];

// // 2. CEK GEOLOCATION: HANYA UBAH JIKA BERHASIL MENDAPATKAN POSISI BARU
// if (navigator.geolocation) {
//     navigator.geolocation.getCurrentPosition(pos => {
//         const { latitude, longitude } = pos.coords;
        
//         // JIKA BERHASIL, BARU TIMPA (OVERWRITE) TAMPILAN PETA DAN INPUT
//         map.setView([latitude, longitude], 13);
//         startInput.value = "Posisi Saya (Lokasi Anda Saat Ini)";
//         startInput.dataset.lat = latitude;
//         startInput.dataset.lon = longitude;
//     }, err => {
//         // Logika untuk error Geolocation atau jika user menolak.
//         console.log('Geolocation gagal/ditolak. Menggunakan lokasi default (Bandung).', err);
//     });
// }
// Variabel untuk menyimpan penanda lokasi dan proses pelacakan
let userLocationMarker = null;
let watchId = null;

// Ambil elemen tombol dari HTML
const locateButton = document.getElementById('locateBtn');
let userAccuracyCircle = null; // <-- TAMBAHKAN VARIABEL BARU INI
// Tambahkan event listener saat tombol di-klik
locateButton.addEventListener('click', () => {
    // Cek apakah browser mendukung Geolocation
    if (!navigator.geolocation) {
        console.error("Browser Anda tidak mendukung Geolocation.");
        return;
    }

    // Jika sedang melacak, hentikan pelacakan (fungsi toggle)
    if (watchId) {
        navigator.geolocation.clearWatch(watchId);
        if (userLocationMarker) {
            map.removeLayer(userLocationMarker);
            userLocationMarker = null;
        }
        watchId = null;
        console.log("Pelacakan lokasi real-time dihentikan."); // Ganti alert dengan log
        return;
    }

    // // Jika belum melacak, mulai pelacakan
    // alert("Memulai pelacakan lokasi real-time. Izinkan akses lokasi jika diminta.");
    
    watchId = navigator.geolocation.watchPosition(
        (position) => {
            // --- FUNGSI JIKA LOKASI BERHASIL DIDAPAT ---
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const userLatLng = L.latLng(lat, lon);

            console.log("Lokasi baru terdeteksi:", userLatLng);

            // Jika penanda belum ada di peta, buat baru.
            if (!userLocationMarker) {
                userLocationMarker = L.marker(userLatLng, { 
                    icon: L.divIcon({
                        className: 'blinking-dot',
                        html: '<div style="background-color: #2563eb; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 15px #2563eb;"></div>',
                        iconSize: [20, 20],
                    }) 
                }).addTo(map);
                map.setView(userLatLng, 16); // Zoom lebih dekat saat pertama kali ditemukan
            } else {
                // Jika penanda sudah ada, pindahkan posisinya.
                userLocationMarker.setLatLng(userLatLng);
            }

            // Selalu update input Start Location
            const startInput = document.getElementById('startLocation');
            startInput.value = "My Location";
            startInput.dataset.lat = lat;
            startInput.dataset.lon = lon;
        },
        (error) => {
            // --- FUNGSI JIKA TERJADI ERROR ---
            console.error("Error saat melacak lokasi: ", error.message);
            navigator.geolocation.clearWatch(watchId); // Hentikan jika error
            watchId = null;
        },
        {
            // Opsi untuk pelacakan yang lebih akurat
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
        }
    );
});



// === 2. Autocomplete & Routing ===
async function getSuggestions(query) {
  if (!query) return [];
  const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&countrycodes=ID&limit=5`);
  const data = await res.json();
  return data.map(i => ({ name: i.display_name, coords: [parseFloat(i.lat), parseFloat(i.lon)] }));
}

function setupAutocomplete(inputId, suggestionsId) {
  const input = document.getElementById(inputId);
  const suggestionsDiv = document.getElementById(suggestionsId);
  input.addEventListener('input', async () => {
    const results = await getSuggestions(input.value);
    suggestionsDiv.innerHTML = results.map(r => `<div class="suggestion-item" data-lat="${r.coords[0]}" data-lon="${r.coords[1]}">${r.name}</div>`).join('');
  });
  suggestionsDiv.addEventListener('click', e => {
    if (e.target.classList.contains('suggestion-item')) {
      input.value = e.target.textContent;
      input.dataset.lat = e.target.dataset.lat;
      input.dataset.lon = e.target.dataset.lon;
      suggestionsDiv.innerHTML = '';
    }
  });
  return () => (input.dataset.lat && input.dataset.lon ? [parseFloat(input.dataset.lat), parseFloat(input.dataset.lon)] : null);
}

const getStartCoords = setupAutocomplete('startLocation', 'startSuggestions');
const getEndCoords = setupAutocomplete('endLocation', 'endSuggestions');

let routingControl;
document.getElementById('routeBtn').addEventListener('click', () => {
  const start = getStartCoords();
  const end = getEndCoords();
  const vehicle = document.querySelector('input[name="vehicle"]:checked')?.value;
  if (!start || !end) return alert('Pilih lokasi awal dan tujuan dari daftar saran');
  if (routingControl) map.removeControl(routingControl);
  routingControl = L.Routing.control({
    waypoints: [L.latLng(...start), L.latLng(...end)],
    router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1', profile: vehicle }),
    lineOptions: { styles: [{ color: 'red', opacity: 0.7, weight: 3, dashArray: '10,6' }] },
    createMarker: (i, wp) => L.marker(wp.latLng)
  }).addTo(map);
});



// ... (Pastikan Anda menambahkan baris ini di awal script untuk mendapatkan elemen label)
const startLabel = document.querySelector('label[for="startLocation"]');
const endLabel = document.querySelector('label[for="endLocation"]');

// === LOGIKA SWAP LOKASI - PERBAIKAN START ===
document.getElementById('swapBtn').addEventListener('click', () => {
    const startInput = document.getElementById('startLocation');
    const endInput = document.getElementById('endLocation');
    // const startLabel = document.querySelector('label[for="startLocation"]'); // Asumsikan sudah didefinisikan
    // const endLabel = document.querySelector('label[for="endLocation"]');     // Asumsikan sudah didefinisikan

    // 1. Swap Nilai Input dan Koordinat (Sudah Benar)
    const tempValue = startInput.value;
    const tempLat = startInput.dataset.lat;
    const tempLon = startInput.dataset.lon;

    startInput.value = endInput.value;
    startInput.dataset.lat = endInput.dataset.lat;
    startInput.dataset.lon = endInput.dataset.lon;

    endInput.value = tempValue;
    endInput.dataset.lat = tempLat;
    endInput.dataset.lon = tempLon;

    // 2. TUKAR TEKS LABEL (BARU DITAMBAHKAN)
    
    const tempLabelText = startLabel.textContent;
    startLabel.textContent = endLabel.textContent;
    endLabel.textContent = tempLabelText;

    
 
    if (startInput.value && endInput.value) {
        document.getElementById('routeBtn').click();
    }
});
// === LOGIKA SWAP LOKASI - PERBAIKAN END ===


// === 3. Marker GeoJSON ===
const RecreationIcon = L.icon({
  iconUrl: '../Image/Marker/Marker_Park.png',
  iconSize: [30, 30],
  iconAnchor: [15, 30],
  popupAnchor: [0, -30],
  className: 'futuristic-icon icon-recreation'
});

function createPointMarker(icon) {
  return (feature, latlng) => L.marker(latlng, { icon });
}

function createPopupContent(feature, layer) {
  if (feature.properties?.Nama) {
    const popup = `
       <div style="width:280px; border-radius:12px; overflow:hidden; font-family:sans-serif; background:#fff; opacity:0.9;"> </div>
          <img src="${feature.properties.gambar}" style="width:100%; height:auto; max-height:160px; object-fit:cover; 
            border-top-left-radius: 10px; /* Radius sudut kiri atas */
            border-top-right-radius: 10px; /* Radius sudut kanan atas */
             border-bottom-left-radius: 10px;
             border-bottom-right-radius: 10px;">
          <div style="padding:10px; display:flex; flex-direction:column; justify-content:space-between;">
            <div>
              <h3 style="margin:0 0 5px 0; font-size:14px; font-weight:600; color:#777">${feature.properties.Kategori}</h3>
              <h3 style="margin:0 0 5px 0; font-size:16px; font-weight:600;">${feature.properties.Nama}</h3>
              <p style="margin:0 0 8px 0; font-size:13px; color:#555; line-height:1.3;">
                ${feature.properties.Jalan}, ${feature.properties.Kecamatan}, ${feature.properties.Kota}, ${feature.properties["Kabupaten/Kota"]}, ${feature.properties.Provinsi}
              </p>
              <p style="margin:0; font-size:13px; color:#333;">
                Koordinat:${feature.geometry.coordinates[1]}, ${feature.geometry.coordinates[0]}
              </p>
            </div>
                    <button onclick="setRouteDestination(${feature.geometry.coordinates[1]}, ${feature.geometry.coordinates[0]}, '${feature.properties.Nama}')"
        style="width:100%; text-align:center; margin-top:8px; padding:8px; font-size:13px; font-weight:600; color:white; background:#007BFF; border:none; border-radius:6px; cursor:pointer;">
        Lihat Rute
        </button>
            </a>
          </div>
         </div>`;
    layer.bindPopup(popup);
  }
}

window.setRouteDestination = (lat, lon, name) => {
  const endInput = document.getElementById('endLocation');
  endInput.value = name;
  endInput.dataset.lat = lat;
  endInput.dataset.lon = lon;
  document.getElementById('routeBtn').click();
};

fetch('../GEOJSON/LokasiWisataRekreasiBandung.json')
  .then(res => res.json())
  .then(data => L.geoJSON(data, { pointToLayer: createPointMarker(RecreationIcon), onEachFeature: createPopupContent }).addTo(map));
</script>
</body>
</html>
